<! Sample dashboard for dtrace+ monitoring scripts for CPU >
<!  CREATED:    14 JUNE 2013 >
<!  MODIFIED:   19 JUNE 2013 >

<html>

<head>
<title>vminfo | Lucera</title>
<script src="./../socket.io/socket.io.js"></script>
<script src="./../depends/d3.v3.js"></script>
</head>

<body>


<script type="text/javascript">

/* Set up global containers / varibles */
var dataset = [];
var countSet =[];
var h = 300;
var textHeight = 14;
var w = 600;
var numberMemory = 3;
var dataMax;
var minSpeed = 60;
var interval = 1200; // in ms
var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
var rad = 2;

var database = new Array("anonfree","anonpgin", "anonpgout", "as_fault","cow_fault","dfree", "execfree", "execpgin", "execpgout", "fsfree", "fspgin", "fspgout", "kernel_asflt", "maj_fault", "pgpin", "pgpout", "pgfrec", "pgrec", "pgrrun", "pgswapin", "pgswapout", "prot_fault", "softlock", "swapin", "swapout", "zfod");

var ref  = new Array("apf","api", "apo", "as", "cow","dfr","epf","epi","epo","fpf","fpi","fpo","kaf","mf","pgpi","pgpo","pgfr","pgre","pgrr","pgsi","pgso","prot","sloc","swi","swo", "zfod");

var colors = ["orange", "red", "green", "purple", "blue", "coral", "cyan",
             "deeppink", "aquamarine", "darkcyan", "lawngreen", "lightpink", "sienna",
                                "steelblue", "teal", "tan", "seagreen", "crimson",
							"darkgreen", "darkmagenta", "darksalmon","thistle" , "fuchsia", "gold" , "olive", "palegreen" ];

var bgColor = "rgba(25, 25, 25, 0.8)";

/* Set Up Grid with labels*/
setInterval(function drawPList () {

	svg.selectAll("rect").remove();
   svg.selectAll("text").remove();

for (var proc=0; proc< database.length; proc++) {
      svg.append("rect")
         .attr("x", proc*(w/database.length))
         .attr("y", 0)
         .attr("width", (w/database.length)-2)
         .attr("height", textHeight)
         .attr("fill", colors[proc]);

      svg.append("text")
         .attr("x", (proc+.5)*(w/database.length)-1)
         .attr("y", textHeight-5)
         .text(ref[proc])
         .attr("font-family", "sans-serif")
         .attr("font-size", (textHeight-8)+"px")
         .attr("fill", "white")
         .attr("text-anchor", "middle");
   }

var idx = 0;
for (var proc in countset)
{
idx = idx + 1

svg.append("rect")
         .attr("x", 0)
         .attr("y", idx*(textHeight+2))
         .attr("width", 200)
         .attr("height", textHeight)
         .attr("fill", bgColor);

      svg.append("rect")
         .attr("x", 200)
         .attr("y", idx*(textHeight+2))
         .attr("width", w-200)
         .attr("height", textHeight)
         .attr("fill", "black");


var position = 200;
for(var other in dataset)
{
another = other % 100000;
if(proc == another)
{
var thisWidth = w * dataset[other][0] / countset[proc];
            svg.append("rect")
               .attr("x", position)
               .attr("y", idx*(textHeight+2))
               .attr("width", thisWidth)
               .attr("height", textHeight)
               .attr("fill", colors[Math.round(other/100000)]);   
               position = position + thisWidth;
}

}



  svg.append("text")
         .text("Pid:    " +  proc)
         .attr("x", 10)
         .attr("y", (idx+1)*(textHeight+2)-7)
         .attr("font-family", "sans-serif")
         .attr("font-size", (textHeight-8)+"px")
         .attr("fill", "white")
         .attr("text-anchor", "start");


svg.append("text")
         .text("Total Count:   " + countset[proc])
         .attr("x", 100)
         .attr("y", (idx+1)*(textHeight+2)-7)
         .attr("font-family", "sans-serif")
         .attr("font-size", (textHeight-8)+"px")
         .attr("fill", "white")
         .attr("text-anchor", "start");
}
});


/* Server IO */
var socket = new io.connect();
socket.on('connect', function(){ 
  console.log(' > connected');

  socket.emit('message', {'type' : 'kstat', 'command' : 'swapStat'});


});

socket.on('message', function(message){ 

  dataset = {};
	countset = {};
  console.log(message);
  for (var id in message) {
      if (id == 'type') continue;
      if (id == 'cpu') continue;
      if (id == 'mem') continue;
}
			dataset["swap"] = message["swap"];
			dataset["swapcap"] = message["swapcap"];
console.log(dataset);	
	

}); 
</script>

</body>
</html>

