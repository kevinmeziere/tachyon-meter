<!. Sample dashboard for dtrace process monitoring scripts      .>
<!.    Displays overview of CPU/DISK/MEM/NETWORK                .>
<!.                                                             .>
<!. CREATED:   14 JUNE 2013                                     .>
<!. MODIFIED:   1 JULY 2013                                     .>

<html>

<head>
<title>Dashboard | Lucera</title>

<script src="socket.io/socket.io.js"></script>
<script src="./depends/raphael.2.1.0.min.js"></script>
<script src="./depends/justgage.1.0.1.min.js"></script>

<script>
var cpugage, memgage, swapgage, netgage, disgage;
var cpustat=0, memstat=0, swapstat=0, diskstat=0, netstat=0;
var lastnetO = 0;
var lastnetI = 0;
var numberCores = 16;
var rate = 4999;

window.onload = function(){
  
  var cpugage = new JustGage({
    id: "cpugage", 
    value: cpustat, 
    min: 0,
    max: 100,
    title: "CPU",
    label: "",
  });

  var memgage = new JustGage({
    id: "memgage", 
    value: 0, 
    min: 0,
    max: 100,
    title: "MEMORY",
    label: "",
  });

  var swapgage = new JustGage({
    id: "swapgage",
    value: 0,
    min: 0,
    max: 100,
    title: "SWAP",
    label: "",
  });

  var netgage = new JustGage({
    id: "netgage", 
    value: 0, 
    min: 0,
    max: 100,
    title: "NETWORK",
    label: "",
  });

  var disgage = new JustGage({
    id: "disgage", 
    value: 0, 
    min: 0,
    max: 100,
    title: "DISK",
    label: "",
  });

  setInterval(function() {
    cpugage.refresh(cpustat);
    memgage.refresh(memstat);
    swapgage.refresh(swapstat);
    netgage.refresh(netstat);
    disgage.refresh(diskstat);
  }, 1200);
};

var socket = new io.connect();

socket.on("connect", function(){ 
  console.log(" > connected");
  socket.emit("message", {"type" : "percpu"});
  socket.emit("message", {"type" : "kstat", "command" : "memStat"});
  socket.emit("message", {"type" : "cmd", "cmd" : "dfUse"});
  socket.emit("message", {"type" : "kstat", "command" : "swapStat"});
  socket.emit("message", {"type" : "kstat", "command" : "netStatSum"});
});

socket.on("message", function(message) {
  
  if (message["type"]=="percpu") {
    cpustat = Math.floor(message["cpu"]/numberCores/rate*1000)/10;
  } else if (message["type"]=="memStat") {
    var tMem = parseInt(message["physmem"]);
    memstat = Math.floor(((tMem-message["freemem"])/tMem)*1000)/10;
  } else if (message["type"]=="dfUse") {
    diskstat = Math.floor( message["used"] / message["available"] * 1000) / 10;
  } else if (message["type"]=="swapStat") {
    swapstat = Math.floor( message["swap"] / ( message["swapcap"]) * 1000) / 10;
  } else if (message["type"]=="netStatSum") {
    netstat = (message["obytes64"]+message["rbytes64"]-lastnetO-lastnetI)*8/message["ifspeed"];
    lastnetO = message["obytes64"];
    lastnetI = message["rbytes64"];
    netstat = Math.floor( netstat*10000 ) / 100;
  }
  
}); 
</script>
</head>

<body>
<center>
<h1>Dashboard | Lucera</h1>
<br><br>

<a href="./cpu/cpustats.html">
  <div id="cpugage" style="width: 250px; height:200px; display: table-cell;"></div>
</a>

<a href="./net/netstats.html">
  <div id="netgage" style="width: 250px; height:200px; display: table-cell;"></div>
</a>

<a href="./mem/memstats.html">
  <div id="memgage" style="width:250px; height:200px; display: table-cell;"></div>
</a>

  <div id="swapgage" style="width:250px; height:200px; display: table-cell;"></div>

<a href="./disk/diskIO.html">
  <div id="disgage" style="width:250px; height:200px; display: table-cell;"></div>
</a>

</center>

<h3>Other utilities</h3>
<a href="./misc/process.html?">"Process zoom"</a> &mdash; allows you to examine the spread of threads and frequency of system calls for a specific process. Append PID of specific process after the query (?) in the url.<br>
<a href="./misc/proc_call.html?">"Process call profile"</a> &mdash; displays all calls (with per-second frequency) made by process (specified by PID in query of URL).<br>
<a href="./misc/syscall.html">"System call info"</a> &mdash; for a specified system call (on-page input box), shows all times a process made the call (and which process made the call, by PID), along with how long it took to fully execute (entry to return).<br><br>

</body>
</html>
