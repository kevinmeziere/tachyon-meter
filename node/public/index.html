<! Sample dashboard for dtrace+ monitoring scripts >
<!  CREATED:    14 JUNE 2013 >
<!  MODIFIED:   24 JUNE 2013 >

<html>
<head>
<title>Dashboard | Lucera</title>

<script src="socket.io/socket.io.js"></script>
<script src="./depends/raphael.2.1.0.min.js"></script>
<script src="./depends/justgage.1.0.1.min.js"></script>

<script>
        var cpugage, memgage, swapgage, netgage, disgage;
        var cpustat=0, memstat=0, swapstat=0, diskstat=0, netstat=0;
				var numberCores = 16;
				var rate = 4999;

        window.onload = function(){
                var cpugage = new JustGage({
                        id: "cpugage", 
                        value: cpustat, 
                        min: 0,
                        max: 100,
                        title: "CPU",
                        label: "",
                });
                
                var memgage = new JustGage({
                        id: "memgage", 
                        value: 0, 
                        min: 0,
                        max: 100,
                        title: "MEMORY",
                        label: "",
                });

								var swapgage = new JustGage({
												id: "swapgage",
												value: 0,
												min: 0,
												max: 100,
												title: "SWAP",
												label: "",
								});
	
                var netgage = new JustGage({
                        id: "netgage", 
                        value: 0, 
                        min: 0,
                        max: 100,
                        title: "NETWORK",
                        label: "",
                });

                var disgage = new JustGage({
                        id: "disgage", 
                        value: 0, 
                        min: 0,
                        max: 100,
                        title: "DISK",
                        label: "",
                });

                setInterval(function() {
                        cpugage.refresh(cpustat);
                        memgage.refresh(memstat);
												swapgage.refresh(swapstat);
                        netgage.refresh(getRandomInt(5,30));
                        disgage.refresh(diskstat);
                }, 1200);
        };

        var socket = new io.connect();
        socket.on('connect', function(){ 
                console.log(' > connected');
                socket.emit("message", {"type" : "percpu"});
                socket.emit("message", {"type" : "kstat", "command" : "memStat"});
								socket.emit("message", {"type" : "cmd", "cmd" : "dfUse"});
								socket.emit("message", {"type" : "kstat", "command" : "swapStat"});
        });

        socket.on('message', function(message) {
								if (message["type"]=="percpu") {
												cpustat = Math.floor(message['cpu']/numberCores/rate*1000)/10;
                } else if (message['type']=='memStat') {
                        var tMem = parseInt(message['physmem']);
                        memstat = Math.floor(((tMem-message['freemem'])/tMem)*1000)/10;
                }
								else if (message['type']=='dfUse') {
												diskstat = Math.floor( message['used'] / message['available'] * 1000) / 10;
								} else if (message['type']=='swapStat') {
												swapstat = Math.floor( message['swap'] / message['swapcap'] * 1000) / 10;
								}
        }); 
</script>
</head>

<body>
<center>
<h1>Dashboard | Lucera</h1>
<br><br>

<div style="display: table;">
    <div style="display: table-row">
        <a href="./cpu/cpustats.html">
                <div id="cpugage" style="width: 300px; height:240px; display: table-cell;"></div>
        </a>
        <!a href="memstats.html">
                <div id="memgage" style="width:300px; height:240px; display: table-cell;"></div>
        <!/a>
    </div>
    <div style="display: table-row">
        <a href="./net/netstats.html">
                <div id="netgage" style="width: 300px; height:240px; display: table-cell;"></div>
        </a>
        <!a href="disstats.html">
                <div id="disgage" style="width:300px; height:240px; display: table-cell;"></div>
        <!/a>
    </div>
		<div style="display: table-row">
				<!a href>
								<div id="swapgage" style="width:300px; height:240px; display: table-cell;"></div>
				<!/a>
		</div>    
</div>

</center>
</body>
</html>
