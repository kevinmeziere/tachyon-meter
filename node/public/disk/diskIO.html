
<!. Sample dashboard for dtrace process monitoring scripts      .>
<!.    Displays time-wise plots of read/write time, bytes,      .>
<!.    and general counts for each disk.                        .>
<!.                                                             .>
<!. CREATED:   24 JUNE 2013                                     .>
<!. MODIFIED:   3 JULY 2013                                     .>

<html>

<head>
<title>diskIO | Lucera</title>
<script src="./../depends/Chart.js"></script>
<script src="./../socket.io/socket.io.js"></script>
<style>

canvas
{
}
</style>
</head>
<body>

<canvas id="canvas" height="300" width="450"></canvas>
<canvas id="canvas2" height="300" width="450"></canvas>
<canvas id="canvas3" height="300" width="450"></canvas>
<canvas id="canvas4" height="300" width="450"></canvas>
<canvas id="canvas5" height="300" width="450"></canvas>
<canvas id="canvas6" height="300" width="450"></canvas>

 
<script>
/* Set up global containers / varibles */
var current = [];
var former =[];
var time = [];
var lineChartData = [];

 

var nr = [];
var nw = [];
var wt = [];
var wl = [];
var r = [];
var w = [];
 

var interval = 1200; // in ms
var numdisks = 13;
var startTime = 0;
var count = 0;


function data()
{

}

/* Set Up Grid with labels*/

setInterval(function () {
lineChartData = {};
  /* Updates the Chart after there are two datapoints to work off of */
  if(count == numdisks*2) {
    for (var i = 0; i <13; i++) {
      nr[i] = [former[i][0],current[i][0]];
      nw[i] = [former[i][1],current[i][1]];
      r[i] = [former[i][2],current[i][2]];
      w[i] = [former[i][3],current[i][3]];
      wt[i] = [former[i][4],current[i][4]];
      wl[i] = [former[i][5],current[i][5]];
    }
  }

 

  /* Updates the data the second time and after */
  if (count > numdisks) {
    for(var i =0; i < numdisks; i++) {
      var nread = current[i][0] - former[i][0];
      var nwritten = current[i][1] - former[i][1];
      var reads = current[i][2] - former[i][2];
      var writes = current[i][3] - former[i][3];
      var wait = current[i][4] - former[i][4];
      var waitl = current[i][5] - former[i][5];
      nr[i].push(nread);
      nw[i].push(nwritten);
      r[i].push(reads);
      w[i].push(writes);
      wt[i].push(wait);
      wl[i].push(waitl);
    }
  }
 
  /*Sets the data for each chart. Does this 6 times */
var bigArray = [nr, nw, r, w, wt, wl];

for(var i = 0; i < 6; i++)

{  
lineChartData[i] = {
    labels : time,
    
    datasets :
    [{
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(125,109,90,1)",
      pointColor : "rgba(125,109,90,1)",
      pointStrokeColor : "#765",
      data: bigArray[i][0]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(255,0,234,1)",
      pointColor : "rgba(255,0,234,1)",
      pointStrokeColor : "#f0e",
      data: bigArray[i][1]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(166,253,191,1)",
      pointColor : "rgba(166,253,191,1)",
      pointStrokeColor : "#afb",
      data: bigArray[i][2]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(183,0,0,1)",
      pointColor : "rgba(183,0,0,1)",
      pointStrokeColor : "#b00",
      data: bigArray[i][3]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(70,130,180,1)",
      pointColor : "rgba(70,130,180,1)",
      pointStrokeColor : "#48b",
      data: bigArray[i][4]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(174,255,58,1)",
      pointColor : "rgba(174,255,58,1)",
      pointStrokeColor : "#af3",
      data: bigArray[i][5]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(255,102,0,1)",
      pointColor : "rgba(255,102,0,1)",
      pointStrokeColor : "#f60",
      data: bigArray[i][6]    
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(255,0,234,1)",
      pointColor : "rgba(0,0,51,1)",
      pointStrokeColor : "#003",
      data: bigArray[i][7]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(102,51,0,1)",
      pointColor : "rgba(102,51,0,1)",
      pointStrokeColor : "#630",
      data: bigArray[i][8] 
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(204,204,204,1)",
      pointColor : "rgba(204,204,204,1)",
      pointStrokeColor : "#CCC",
      data: bigArray[i][9]     
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(255,255,51,1)",
      pointColor : "rgba(252,255,51,1)",
      pointStrokeColor : "#ff3",
      data: bigArray[i][10]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(0,255,255,1)",
      pointColor : "rgba(0,255,255,1)",
      pointStrokeColor : "#0ff",
      data: bigArray[i][11]
    },
    {
      fillColor : "rgba(0,0,0,0)",
      strokeColor : "rgba(201,0,204,1)",
      pointColor : "rgba(201,0,204,1)",
      pointStrokeColor : "#C0C",
      data: bigArray[i][12]
    }]
  };
}

var Line1 = new Chart(document.getElementById("canvas")
                              .getContext("2d")).Line(lineChartData[0]);
var Line1 = new Chart(document.getElementById("canvas2")
                              .getContext("2d")).Line(lineChartData[1]);
var Line2 = new Chart(document.getElementById("canvas3")
                              .getContext("2d")).Line(lineChartData[2]);
var Line3 = new Chart(document.getElementById("canvas4")
                              .getContext("2d")).Line(lineChartData[3]);
var Line4 = new Chart(document.getElementById("canvas5")
                              .getContext("2d")).Line(lineChartData[4]);
var Line5 = new Chart(document.getElementById("canvas6")
                              .getContext("2d")).Line(lineChartData[5]);

}, 1001);

/* Server IO */
var socket = new io.connect();

socket.on('connect', function(){
  console.log(' > connected');

  for(var i =0; i < numdisks; i++) {
    socket.emit("message", {"type" : "kstat", "command" : "diskIO$I$", "vars" : 2, "vars2" : i});
  }

  startTime = new Date().getTime();
});

socket.on("message", function(message){
  var s = parseInt(message["type"].substring(6));
  former[s] = current[s];
  current[s] = [ message["nread"]/1024,  message["nwritten"]/1024, message["reads"], message["writes"], message["wtime"], message["wlentime"] ];

  count++;

  /* Updates the time only once per cycle */

  if(s== 12) {
    var thisTime = Math.floor((new Date().getTime() - startTime)/1000);
    time.push( Math.floor(thisTime/60) + "m" + (thisTime%60) );
  }

  /* Pushes back the data after the 10th run at the end of the cycle */
  if (count  > 130 && count % 13 == 0) {
    for (var i = 0; i < numdisks; i++) {
      nw[i].splice(0,1);
      nr[i].splice(0,1);
      w[i].splice(0,1);
      r[i].splice(0,1);
      wt[i].splice(0,1);
      wl[i].splice(0,1);
    }
    time.shift();
  }

});

</script>

<br><br>
per Disk Stats<br><br>
Top-left: KB reads <br>
Top-center: KB writes<br>
Top-right: Read counts<br>
Bottom-left: Write Counts<br>
Bottom-center: wtime<br>
Bottom-right: wlentime
<br><br>

D0: Khaki Brown D1: Pink D2: Seagreen D3: Red<br>
D4: Medium Blue D5: Lime Green D6: Orange D7: Dark Blue<br>
D8: Brown D9: Grey D10:Yellow D11:Light Blue D12:Purple<br><br><br>

<br><br><br>
<a href="./diskErrors.html">Disk Errors</a>
<br><br><br>

</body>
</html>
